<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ADMIN SWITCH PRO</title>

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#020617;
  color:#e5e7eb;
}

.panel{
  max-width:460px;
  margin:60px auto;
  background:#020617;
  border:1px solid #1e293b;
  border-radius:16px;
  padding:20px;
}

.title{
  text-align:center;
  font-size:20px;
  font-weight:bold;
  margin-bottom:20px;
}

.row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 0;
  border-bottom:1px solid #1e293b;
}

.small{
  font-size:12px;
  color:#9ca3af;
}

/* ===== SWITCH ===== */
.switch{
  position:relative;
  width:72px;
  height:32px;
  border-radius:999px;
  transition:background 0.25s ease;
}

/* ADMIN m·ªõi click ƒë∆∞·ª£c */
.switch.admin{
  cursor:pointer;
}
.switch.viewer{
  opacity:.5;
}

/* LOCK */
.switch.locked{
  background:#facc15;
}
/* OPEN */
.switch.unlocked{
  background:#22c55e;
}

.switch::after{
  content:"";
  position:absolute;
  top:3px;
  left:3px;
  width:26px;
  height:26px;
  background:#020617;
  border-radius:50%;
  transition:transform .25s cubic-bezier(.4,0,.2,1);
}
.switch.unlocked::after{
  transform:translateX(40px);
}

/* RUNG */
@keyframes shake{
  0%{transform:translateX(0)}
  25%{transform:translateX(-2px)}
  50%{transform:translateX(2px)}
  100%{transform:translateX(0)}
}
.switch.shake{
  animation:shake .25s;
}
</style>
</head>

<body>

<div class="panel">
  <div class="title">ADMIN PANEL</div>
  <div id="list"></div>
</div>

<script>
const STORAGE_KEY = "switch_state_v1";

/* ===== DATA ===== */
let admins = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [
  {name:"Th·ª£ A", key:"A", lock:false, count:0, last:null},
  {name:"Th·ª£ B", key:"B", lock:true,  count:0, last:null},
  {name:"Th·ª£ C", key:"C", lock:false, count:0, last:null}
];

function save(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(admins));
}

/* ===== ROUTE ===== */
const p = new URLSearchParams(location.search);
const u = p.get("u");
const isAdmin = (u === "ADMIN");

/* ===== WORKER ACCESS ===== */
if(u && !isAdmin){
  const a = admins.find(x=>x.key===u);
  if(a){
    a.count++;
    a.last = new Date().toLocaleString("vi-VN");
    save();

    if(a.lock){
      document.body.innerHTML = `
        <h2 style="text-align:center;color:#facc15;margin-top:120px">
          üîí T√ÄI KHO·∫¢N ƒê√É B·ªä KH√ìA
        </h2>`;
    }
  }
}

/* ===== RENDER ===== */
function render(){
  list.innerHTML = admins.map((a,i)=>`
    <div class="row">
      <div>
        <b>${a.name}</b>
        <div class="small">üëÅ ${a.count} l·∫ßn</div>
        ${a.last ? `<div class="small">üïí ${a.last}</div>` : ""}
      </div>

      <div class="switch ${a.lock?"locked":"unlocked"} ${isAdmin?"admin":"viewer"}"
           ${isAdmin ? `onclick="toggle(${i}, this)"` : ""}>
      </div>
    </div>
  `).join("");
}

/* ===== TOGGLE (ADMIN ONLY) ===== */
function toggle(i, el){
  if(!isAdmin) return;

  admins[i].lock = !admins[i].lock;
  save();

  el.classList.remove("shake");
  void el.offsetWidth;
  el.classList.add("shake");

  render();
}

render();
</script>

</body>
</html>
